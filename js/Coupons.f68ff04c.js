(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Coupons"],{a193:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("TableTitle",e._b({on:{openDialog:e.openDialog,deleteHandler:e.deleteHandler}},"TableTitle",e.tableTitlePost,!1)),n("Table-view",e._b({ref:"TableView",on:{btnHandle:e.openDialog,"row-selection":e.setSelection,handleCurrentChange:e.handleCurrentChange,handleSizeChange:e.handleSizeChange}},"Table-view",e.tableViewPost,!1)),n("Dialog",e._b({attrs:{visible:e.$store.state.Dialog.dialogVisible},on:{"update:visible":function(t){return e.$set(e.$store.state.Dialog,"dialogVisible",t)},submit:e.submitForm}},"Dialog",e.dialogPost,!1))],1)},a=[],r=(n("4160"),n("159b"),n("96cf"),n("1da1")),i=(n("99af"),n("dca8"),n("7c15")),c=n("1b03"),s=n("5530"),u=n("d4ec"),d=n("bee2"),l=n("262e"),p=n("2caf"),m=n("211b"),f=function(e){Object(l["a"])(n,e);var t=Object(p["a"])(n);function n(){return Object(u["a"])(this,n),t.apply(this,arguments)}return Object(d["a"])(n,[{key:"transform",value:function(){return Object(s["a"])(Object(s["a"])({},this.data),{},{deadline_at:this.data.deadline.datetime})}}]),n}(m["a"]),h=f,b=(n("d81d"),function(e){Object(l["a"])(n,e);var t=Object(p["a"])(n);function n(){return Object(u["a"])(this,n),t.apply(this,arguments)}return Object(d["a"])(n,[{key:"transform",value:function(){return this.data.map((function(e){return Object(s["a"])(Object(s["a"])({},e),{},{deadline_at:e.deadline.datetime})}))}}]),n}(m["a"])),g=b,O=n("c1df"),D={namespaced:!0,state:function(){return{columns:Object.freeze([{name:"全選",type:"selection"},{name:"名稱",desc:"title"},{name:"序號",desc:"code"},{name:"折扣百分比",desc:"percent"},{name:"是否開放",desc:"enabled",formatter:function(e){return e?'<p class="text-success">啟用</p>':'<p class="text-danger">未啟用</p>'}},{name:"到期日",desc:"deadline_at",formatter:function(e){return O(e).format("YYYY-MM-DD")}},{name:"操作",width:"150",btns:[{name:"修改",btnType:"warning",method:"edit"},{name:"刪除",btnType:"danger",method:"delete"}]}]),formData:{title:"",code:"",percent:0,deadline_at:"",enabled:!1},ruleForm:Object.freeze([{name:"名稱",clearable:!0,type:"Input",prop:"title",rules:"required",required:!0},{name:"序號",clearable:!0,type:"Input",prop:"code",rules:"required",required:!0},{name:"折扣百分比",clearable:!0,type:"NumberInput",prop:"percent",rules:"required|integer",required:!0,max:2},{name:"到期日",clearable:!0,prop:"deadline_at",type:"Date"},{name:"是否開放",clearable:!0,type:"SwitchBox",prop:"enabled",rules:"required"}]),tableData:[]}},actions:{getCoupon:function(e){return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.commit,o=e.rootState,n("Loading/LOADING",!0,{root:!0}),t.next=4,Object(i["i"])("page=".concat(o.Pagination.current,"&paged=").concat(o.Pagination.paged)).then((function(e){n("Pagination/SET_TOTAL",e.meta.pagination.total,{root:!0}),n("Pagination/SET_TOTAL_PAGES",e.meta.pagination.total_pages,{root:!0});var t=new g(e.data);n("GET_TABLE_DATA",t.transform()),n("Loading/LOADING",!1,{root:!0})}));case 4:case"end":return t.stop()}}),t)})))()},getSingleCoupon:function(e,t){return Object(r["a"])(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.commit,o("Loading/LOADING",!0,{root:!0}),n.next=4,Object(i["l"])(t).then((function(e){var t=new h(e.data);o("SET_FORM_DATA",t.transform()),o("Loading/LOADING",!1,{root:!0})}));case 4:case"end":return n.stop()}}),n)})))()},createCoupon:function(e){return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.state,o=e.commit,a=e.dispatch,o("Loading/LOADING",!0,{root:!0}),t.next=4,Object(i["b"])(n.formData).then((function(){o("Loading/LOADING",!1,{root:!0}),Object(c["b"])("訊息","新增成功","success"),o("Dialog/CLEAR_DIALOG",!1,{root:!0}),a("getCoupon")}));case 4:case"end":return t.stop()}}),t)})))()},editCoupon:function(e){return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.state,o=e.dispatch,a=e.commit,a("Loading/LOADING",!0,{root:!0}),t.next=4,Object(i["g"])(n.formData.id,n.formData).then((function(){a("Loading/LOADING",!1,{root:!0}),Object(c["b"])("訊息","修改成功","success"),a("Dialog/CLEAR_DIALOG",!1,{root:!0}),o("getCoupon")}));case 4:case"end":return t.stop()}}),t)})))()},deleteCoupon:function(e,t){return Object(r["a"])(regeneratorRuntime.mark((function n(){var o,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.commit,a=e.dispatch,o("Loading/LOADING",!0,{root:!0}),n.next=4,Object(i["d"])(t).then((function(){Object(c["b"])("訊息","删除成功","success"),o("Loading/LOADING",!1,{root:!0}),a("getCoupon")}));case 4:case"end":return n.stop()}}),n)})))()},open:function(e,t){var n=e.commit,o=t.type;"add"===o.method&&(n("INIT_FORM_DATA"),n("Dialog/DIALOG_ADD","新增資料",{root:!0}))},updateOpen:function(e,t){return Object(r["a"])(regeneratorRuntime.mark((function n(){var o,a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,a=e.dispatch,r=t.type,"edit"!==r.method){n.next=6;break}return n.next=5,a("getSingleCoupon",r.row.id);case 5:o("Dialog/DIALOG_EDIT","修改文章",{root:!0});case 6:case"end":return n.stop()}}),n)})))()},deleteOpen:function(e,t){var n=e.dispatch,o=t.type;"delete"===o.method&&Object(c["a"])().then((function(){n("deleteCoupon",o.row.id)})).catch((function(){Object(c["b"])("info","已取消删除","info")}))}},mutations:{GET_TABLE_DATA:function(e,t){e.tableData=Object.freeze(t)},INIT_FORM_DATA:function(e){e.formData={title:"",code:"",percent:0,deadline_at:"",enabled:!1}},SET_FORM_DATA:function(e,t){e.formData=t}}},C={name:"Coupons",data:function(){return{title:"優惠卷列表",selection:[]}},computed:{tableTitlePost:function(){return{title:this.title,selection:this.selection}},tableViewPost:function(){return{title:this.title,data:this.$store.state.Coupons.tableData,columns:this.$store.state.Coupons.columns}},dialogPost:function(){return{title:this.$store.state.Dialog.dialogTitle,"rule-form":this.$store.state.Coupons.ruleForm,"form-data":this.$store.state.Coupons.formData,"is-edit":this.$store.state.Dialog.dialogIsEdit,"v-if":this.$store.state.Dialog.dialogVisible}}},created:function(){this.$registerModule(this.$store,{Coupons:D})},mounted:function(){this.$store.commit("Pagination/SET_CURRENT",1),this.$store.dispatch("Coupons/getCoupon")},beforeDestroy:function(){this.$unregisterModule(this.$store,["Coupons"])},methods:{handleSizeChange:function(e){this.$store.commit("Pagination/SET_PAGED",e),this.$store.dispatch("Coupons/getCoupon")},handleCurrentChange:function(e){this.$store.commit("Pagination/SET_CURRENT",e),this.$store.dispatch("Coupons/getCoupon")},setSelection:function(e){this.selection=e},deleteHandler:function(){var e=this;this.selection.forEach((function(t){e.$store.dispatch("Coupons/deleteCoupon",t.id)}))},openDialog:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.$store.dispatch("Coupons/open",{type:e}),n.next=3,t.$store.dispatch("Coupons/updateOpen",{type:e});case 3:t.$store.dispatch("Coupons/deleteOpen",{type:e});case 4:case"end":return n.stop()}}),n)})))()},submitForm:function(e,t){e&&("add"===t?this.$store.dispatch("Coupons/createCoupon"):this.$store.dispatch("Coupons/editCoupon"))}}},w=C,T=n("2877"),A=Object(T["a"])(w,o,a,!1,null,null,null);t["default"]=A.exports}}]);